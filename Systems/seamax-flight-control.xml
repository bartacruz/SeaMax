<?xml version="1.0"?>
<flight_control name="FCS: seamax">

  <channel name="Pitch">

    <summer name="Pitch Trim Sum">
      <input>fcs/elevator-cmd-norm</input>
      <input>fcs/pitch-trim-cmd-norm</input>
      <clipto>
        <min> -1 </min>
        <max> 1 </max>
      </clipto>
    </summer>

    <aerosurface_scale name="Elevator Control">
      <input>fcs/pitch-trim-sum</input>
      <range>
        <min> -0.25 </min>
        <max> 0.25 </max>
      </range>
      <output>fcs/elevator-pos-rad</output>
    </aerosurface_scale>

    <aerosurface_scale name="elevator normalization">
      <input>fcs/elevator-pos-rad</input>
      <domain>
        <min> -0.25 </min>
        <max> 0.25 </max>
      </domain>
      <range>
        <min> -1 </min>
        <max> 1 </max>
      </range>
      <output>fcs/elevator-pos-norm</output>
    </aerosurface_scale>

  </channel>

  <channel name="Roll">

    <summer name="Roll Trim Sum">
      <input>fcs/aileron-cmd-norm</input>
      <input>fcs/roll-trim-cmd-norm</input>
      <clipto>
        <min> -1 </min>
        <max> 1 </max>
      </clipto>
    </summer>

    <aerosurface_scale name="Left Aileron Control">
      <input>fcs/roll-trim-sum</input>
      <range>
        <min> -0.25 </min>
        <max> 0.25 </max>
      </range>
      <output>fcs/left-aileron-pos-rad</output>
    </aerosurface_scale>

    <aerosurface_scale name="Right Aileron Control">
      <input>fcs/roll-trim-sum</input>
      <range>
        <min> -0.25 </min>
        <max> 0.25 </max>
      </range>
      <output>fcs/right-aileron-pos-rad</output>
    </aerosurface_scale>

    <aerosurface_scale name="left aileron normalization">
      <input>fcs/left-aileron-pos-rad</input>
      <domain>
        <min> -0.25 </min>
        <max> 0.25 </max>
      </domain>
      <range>
        <min> -1 </min>
        <max> 1 </max>
      </range>
      <output>fcs/left-aileron-pos-norm</output>
    </aerosurface_scale>

    <aerosurface_scale name="right aileron normalization">
      <input>fcs/right-aileron-pos-rad</input>
      <domain>
        <min> -0.25 </min>
        <max> 0.25 </max>
      </domain>
      <range>
        <min> -1 </min>
        <max> 1 </max>
      </range>
      <output>fcs/right-aileron-pos-norm</output>
    </aerosurface_scale>

  </channel>

  <channel name="Yaw">

    <summer name="Rudder Command Sum">
      <input>fcs/rudder-cmd-norm</input>
      <input>fcs/yaw-trim-cmd-norm</input>
      <clipto>
        <min> -1 </min>
        <max> 1 </max>
      </clipto>
    </summer>

    <aerosurface_scale name="Rudder Control">
      <input>fcs/rudder-command-sum</input>
      <range>
        <min> -0.25 </min>
        <max> 0.25 </max>
      </range>
      <output>fcs/rudder-pos-rad</output>
    </aerosurface_scale>

    <aerosurface_scale name="rudder normalization">
      <input>fcs/rudder-pos-rad</input>
      <domain>
        <min> -0.25 </min>
        <max> 0.25 </max>
      </domain>
      <range>
        <min> -1 </min>
        <max> 1 </max>
      </range>
      <output>fcs/rudder-pos-norm</output>
    </aerosurface_scale>

  </channel>

  <channel name="Flaps">
    <kinematic name="Flaps Control">
      <input>fcs/flap-cmd-norm</input>
      <traverse>
        <setting>
          <position> 0 </position>
          <time> 0 </time>
        </setting>
        <setting>
          <position> 10 </position>
          <time> 2 </time>
        </setting>
        <setting>
          <position> 35 </position>
          <time> 3 </time>
        </setting>
      </traverse>
      <output>fcs/flap-pos-deg</output>
    </kinematic>

    <aerosurface_scale name="flap normalization">
      <input>fcs/flap-pos-deg</input>
      <domain>
        <min> 0 </min>
        <max> 35 </max>
      </domain>
      <range>
        <min> 0 </min>
        <max> 1 </max>
      </range>
      <output>fcs/flap-pos-norm</output>
    </aerosurface_scale>

  </channel>

  <channel name="Jacks">
    
    <!-- Traverse the normalized jacks position based on switch -->
    <kinematic name="jacks on">
      <input>/controls/gear/jacks-on</input>
      <traverse>
        <setting>
          <position>0</position>
          <time>0 </time>
        </setting>
        <setting>
          <position>1</position>
          <time>5</time>
        </setting>
      </traverse>
      <output>contact/jacks-pos-norm</output>
      <output>/controls/gear/jacks-pos-norm</output>
    </kinematic>

    <!-- Calculate the height of the jacks (Z position) -->
    <fcs_function name="fcs/jacks-pos-z">
      <function>
        <table>
          <independentVar lookup="row">contact/jacks-pos-norm</independentVar>
          <tableData>
            0   24
            0.2 10
            0.3  5
            0.4  3
            1   -3
          </tableData>
        </table>
      </function>
    </fcs_function>

    <!-- Apply the position to the jacks only if enabled-->
    <switch name="Jacks position z">
      <default value="contact/unit[3]/z-position" />
      <output>contact/unit[3]/z-position</output>
      <output>contact/unit[4]/z-position</output>
      <output>contact/unit[5]/z-position</output>
      <test logic="OR" value="fcs/jacks-pos-z">
        /controls/gear/jacks-operable eq 1
      </test>
    </switch>
  </channel>
  
  <channel name="Landing Gear">

    <!-- Disable gear movement if electrical voltage is too low ("borrowed" from c172p)-->
    <switch name="Gear Command">
      <default value="gear/gear-cmd-norm" />
      <output>gear/gear-input-norm</output>
      <!-- Route back the (normalized) output of the <kinematic>
           to its input in order to disable it.
      -->
      <test logic="AND" value="gear/gear-pos-norm">
        /controls/gear/detecting eq 0
        /systems/electrical/outputs/main-bus lt 7
      </test>
    </switch>

    <kinematic name="Gr">
      <input>gear/gear-input-norm</input>
      <traverse>
        <setting>
          <position>0</position>
          <time>0 </time>
        </setting>
        <setting>
          <position>1</position>
          <time>5</time>
        </setting>
      </traverse>
      <output>gear/gear-pos-norm</output>
    </kinematic>

    <kinematic name="Gr lever">
      <input>gear/gear-input-norm</input>
      <traverse>
        <setting>
          <position>0</position>
          <time>0 </time>
        </setting>
        <setting>
          <position>1</position>
          <time>1</time>
        </setting>
      </traverse>
      <output>/controls/gear/gear-lever-norm</output>
    </kinematic>

    <switch name="Gear in transit">
      <default value="0" />
      <output>/controls/gear/gear-in-transit</output>
      <test logic="AND" value="1">
        gear/gear-pos-norm gt 0
        gear/gear-pos-norm lt 1
      </test>
    </switch>

    <kinematic name="/controls/gear/water-rudder-down">
      <input>/controls/gear/water-rudder</input>
      <traverse>
        <setting>
          <position>0</position>
          <time>0 </time>
        </setting>
        <setting>
          <position>1</position>
          <time>1</time>
        </setting>
      </traverse>
    </kinematic>
  </channel>

  <channel name="Speedbrake">
    <kinematic name="Speedbrake Control">
      <input>fcs/speedbrake-cmd-norm</input>
      <traverse>
        <setting>
          <position> 0 </position>
          <time> 0 </time>
        </setting>
        <setting>
          <position> 1 </position>
          <time> 1 </time>
        </setting>
      </traverse>
      <output>fcs/speedbrake-pos-norm</output>
    </kinematic>

  </channel>
  <channel name="alpha-wing-rad-to-deg">
    <pure_gain name="wing-incidence-deg">
      <input>aero/alpha-wing-rad</input>
      <gain>57.29578</gain>
      <output>aero/alpha-wing-deg</output>
    </pure_gain>
  </channel>

</flight_control>